name: "Feature Branch Pipeline"

on:
  push:
    branches: [ "feature/**" ]
  pull_request:
    branches: [ "feature/**" ]

jobs:

  build:
    name: Debug Build
    runs-on: ubuntu-latest
    # https://hub.docker.com/r/fabernovel/android/tags
    container: fabernovel/android:api-33-gcloud-ndk-v1.7.0

    steps:
    - name: checkout
      uses: actions/checkout@v3
    - name: Gradle cache
      uses: actions/cache@v3
      with:
        path: |
          /root/.gradle/caches
          /root/.gradle/wrapper
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
        restore-keys: |
          ${{ runner.os }}-gradle-
    - name: Gradle build
      run: ./gradlew assembleDebug
        
  unitTests:
     name: Unit Tests
     runs-on: ubuntu-latest
     needs: build
     # https://hub.docker.com/r/fabernovel/android/tags
     container: fabernovel/android:api-33-gcloud-ndk-v1.7.0

     steps:
     - name: checkout
       uses: actions/checkout@v3
     - name: Gradle cache
       uses: actions/cache@v3
       with:
         path: |
          /root/.gradle/caches
          /root/.gradle/wrapper
         key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
         restore-keys: |
          ${{ runner.os }}-gradle-
     - name: Gradle build
       run: ./gradlew compileDebugUnitTestSources    

  createPR:
    name: Create a PullRequest       
    needs: unitTests
    uses: peter-evans/create-pull-request@v5.0.2
    with:
      # GITHUB_TOKEN or a `repo` scoped Personal Access Token (PAT)
      token: ${{ github.token }}
      author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
      delete-branch: true
      base: main

    
  integrationTests:
     name: Integration Tests
     runs-on: ubuntu-latest
     needs: build
     # https://hub.docker.com/r/fabernovel/android/tags
     container: fabernovel/android:api-33-gcloud-ndk-v1.7.0

     steps:
     - name: checkout
       uses: actions/checkout@v3
     - name: Gradle cache
       uses: actions/cache@v3
       with:
         path: |
          /root/.gradle/caches
          /root/.gradle/wrapper
         key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
         restore-keys: |
          ${{ runner.os }}-gradle-
     - name: Gradle build
       run: ./gradlew compileDebugUnitTestSources        


    
    
  
  
